<%= stylesheet_link_tag "conversations"%>
<div class="page">
  <div class="container">
<div class="chatbox">
  <div id="frame">
    <div id="sidepanel">
      <div id="profile">
        <div class="wrap">
          <%= image_tag current_user.employer.latest_image, class: "online", id: "profile-img" %>
          <p><%= current_user.first_name %> <%= current_user.last_name %></p>
        </div>
      </div>
      <div id="contacts">
        <ul>
          <% if @user %>
              <li class="contact">
                <div class="wrap">
                  <%= image_tag @user.contractor.latest_image %>
                  <div class="meta">
                    <p><%= link_to @user.full_name, "javascript:", class: "name" %></p>
                    <p class="preview">Send Message</p>
                  </div>
                </div>
              </li>
          <% end %>
          <%= render 'partials/chatroom_users_listing', locale: { conversations: @conversations } %>
         </ul>
      </div>
    </div>
    <div class="content">
      <div class="contact-profile">
        <%= render 'partials/chatting_with', locale: { conversation: @conversation } %>
      </div>
      <div class="messages">
        <%= render 'partials/chat_messages', locale: { conversation: @conversation } %>
      </div>
      <div class="message-input">
        <div class="wrap">
          <%= render 'partials/new_chatroom', locale: { conversation: @conversation }%>
        </div>
      </div>
    </div>
  </div>
  <script src='//production-assets.codepen.io/assets/common/stopExecutionOnTimeout-b2a7b3fe212eaa732349046d8416e00a9dec26eb7fd347590fbced3ab38af52e.js'></script><script src='https://code.jquery.com/jquery-2.2.4.min.js'></script>
  <script >$(".messages").animate({ scrollTop: $(document).height() }, "fast");

  $("#profile-img").click(function() {
      $("#status-options").toggleClass("active");
  });

  $(".expand-button").click(function() {
      $("#profile").toggleClass("expanded");
      $("#contacts").toggleClass("expanded");
  });

  $("#status-options ul li").click(function() {
      $("#profile-img").removeClass();
      $("#status-online").removeClass("active");
      $("#status-away").removeClass("active");
      $("#status-busy").removeClass("active");
      $("#status-offline").removeClass("active");
      $(this).addClass("active");

      if($("#status-online").hasClass("active")) {
          $("#profile-img").addClass("online");
      } else if ($("#status-away").hasClass("active")) {
          $("#profile-img").addClass("away");
      } else if ($("#status-busy").hasClass("active")) {
          $("#profile-img").addClass("busy");
      } else if ($("#status-offline").hasClass("active")) {
          $("#profile-img").addClass("offline");
      } else {
          $("#profile-img").removeClass();
      };

      $("#status-options").removeClass("active");
  });

  function newMessage() {
      message = $(".bodytext").val();
      if($.trim(message) == '') {
          return false;
      }
      $('<li class="sent"><img src="http://emilcarlsson.se/assets/mikeross.png" alt="" /><p>' + message + '</p></li>').appendTo($('.messages ul'));
//      $('.bodytext').val(null);
      $('.contact.active .preview').html('<span>You: </span>' + message);
      $(".messages").animate({ scrollTop: $(document).height() }, "fast");
  };

  $('.submit').click(function() {
      newMessage();
  });

  $(window).on('keydown', function(e) {
      if (e.which == 13) {
          newMessage();
          return false;
      }
  });
  //# sourceURL=pen.js
  </script>
</div>
    <ul class="list-group"></ul>
</div>
</div>